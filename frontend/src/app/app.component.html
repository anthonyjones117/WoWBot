<div *ngIf="!loggedIn" class="login-wrapper wow-theme">
  <div class="login-card">
    <h2 class="wow-title">WoWBot</h2>
    <form (submit)="login(); $event.preventDefault();">
      <div class="form-group">
        <label for="username">Username</label>
        <input id="username" [(ngModel)]="username" name="username" required class="input" placeholder="Enter your username" />
      </div>
      <div class="form-group">
        <label for="password">Password</label>
        <input id="password" type="password" [(ngModel)]="password" name="password" required class="input" placeholder="Enter access code" />
      </div>
      <button type="submit" class="btn wow-btn">Login</button>
      <p *ngIf="loginError" class="error-msg">Incorrect password.</p>
    </form>
  </div>
</div>


<div *ngIf="loggedIn" class="chat-wrapper">
  <div class="chat-card">
    <h2 class="wow-title">Chat Room</h2>
    <div class="chat-controls">
      <button (click)="connectWithBlizzard()" class="small-btn">Connect with Blizzard</button>
      <button (click)="fetchCharacterProfile()" class="small-btn">Fetch WoW Profile</button>
      <button (click)="clearAllMessages()" class="small-btn">Clear Chat</button>
      <button (click)="logout()" class="small-btn">Logout</button>
    </div>

    <div *ngIf="profileInfo" class="profile-info">
      <h3>WoW Profile Updated in Memory</h3>
    </div>

    <ul id="messages">
      <li *ngFor="let message of messages"
          [ngClass]="{'agent-message': message.role === 'agent', 'user-message': message.role === 'user'}">
        
        <!-- Agent messages get custom HTML -->
        <span *ngIf="message.role === 'agent'" [innerHTML]="isSystemMessage(message)"></span>

        <!-- User messages get plain rendering -->
        <span *ngIf="message.role === 'user'">
          <span style="font-weight: bold;">{{ message.sender }}:</span> {{ message.text }}
        </span>

      </li>
    </ul>

    <form (submit)="send(); $event.preventDefault();" class="chat-form">
      <input
        [(ngModel)]="chatBox"
        [ngModelOptions]="{ standalone: true }"
        autocomplete="off"
        placeholder="Type your message..."
      />
      <button type="submit" class="btn">Send</button>
    </form>
  </div>
</div>
<router-outlet></router-outlet>
